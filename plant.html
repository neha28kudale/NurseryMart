<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Detail - NurseryMart</title>
    <link rel="stylesheet" href="css/common.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#22c55e',
                        'primary-dark': '#16a34a',
                        'primary-light': '#bbf7d0'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
  <div class="header"></div>

    <!-- Main Content -->
    <div class="container">
        <div id="plantContent" class="max-w-6xl mx-auto">
            <!-- Loading state -->
            <div id="loadingState" class="text-center py-12">
                <div class="spinner mx-auto mb-4"></div>
                <p class="text-gray-500">Loading plant details...</p>
            </div>

            <!-- Plant not found -->
            <div id="notFoundState" class="hidden text-center py-12">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33"></path>
                </svg>
                <h3 class="text-lg font-medium text-gray-900 mb-2">Plant Not Found</h3>
                <p class="text-gray-500">The plant you're looking for doesn't exist or has been removed.</p>
                <a href="index.html" class="btn primary mt-4">Go Back Home</a>
            </div>

            <!-- Plant details -->
            <div id="plantDetails" class="hidden">
                <!-- Breadcrumb -->
                <nav class="text-sm text-gray-500 mb-6">
                    <a href="index.html" class="hover:text-primary">Home</a>
                    <span class="mx-2">/</span>
                    <a href="categories.html" class="hover:text-primary">Categories</a>
                    <span class="mx-2">/</span>
                    <span id="plantCategory" class="text-gray-900"></span>
                    <span class="mx-2">/</span>
                    <span id="plantName" class="text-gray-900"></span>
                </nav>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Plant Images -->
                    <div class="space-y-4">
                        <div class="aspect-w-1 aspect-h-1 bg-gray-200 rounded-lg overflow-hidden">
                            <img id="mainImage" src="" alt="" class="w-full h-full object-cover">
                        </div>
                        <div id="imageGallery" class="grid grid-cols-4 gap-2">
                            <!-- Additional images will be populated here -->
                        </div>
                    </div>

                    <!-- Plant Information -->
                    <div class="space-y-6">
                        <!-- Basic Info -->
                        <div>
                            <div class="flex items-center gap-3 mb-3">
                                <span id="categoryBadge" class="badge primary"></span>
                                <div class="flex items-center gap-1">
                                    <span class="text-yellow-400">★</span>
                                    <span id="plantRating" class="text-sm font-medium"></span>
                                    <span id="plantReviews" class="text-sm text-gray-500"></span>
                                </div>
                            </div>
                            <h1 id="plantTitle" class="text-3xl font-bold text-gray-900 mb-2"></h1>
                            <p id="plantDescription" class="text-gray-600 text-lg"></p>
                        </div>

                        <!-- Price and Stock -->
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div>
                                <span id="plantPrice" class="text-3xl font-bold text-primary"></span>
                                <p class="text-sm text-gray-500">Free delivery on orders above ₹500</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-500">Stock</p>
                                <p id="plantStock" class="text-lg font-semibold text-gray-900"></p>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="space-y-3">
                            <div class="flex gap-3">
                                <button id="addToCartBtn" class="btn primary flex-1">
                                    Add to Cart
                                </button>
                                <button id="favoriteBtn" class="btn secondary">
                                    <span id="favoriteIcon">☆</span>
                                </button>
                            </div>
                            <button id="messageSellerBtn" class="btn outline w-full">
                                Message Seller
                            </button>
                        </div>

                        <!-- Plant Details -->
                        <div class="border-t pt-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Plant Details</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-500">Care Level</p>
                                    <p id="careLevel" class="font-medium"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Water Needs</p>
                                    <p id="waterNeeds" class="font-medium"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Light Needs</p>
                                    <p id="lightNeeds" class="font-medium"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Height</p>
                                    <p id="plantHeight" class="font-medium"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Pot Size</p>
                                    <p id="potSize" class="font-medium"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Seller</p>
                                    <p id="sellerName" class="font-medium text-primary cursor-pointer hover:underline"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reviews Section -->
                <div class="mt-12 border-t pt-8">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Customer Reviews</h3>
                    <div id="reviewsSection" class="space-y-4">
                        <!-- Reviews will be populated here -->
                    </div>
                </div>

                <!-- Related Plants -->
                <div class="mt-12 border-t pt-8">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Related Plants</h3>
                    <div id="relatedPlants" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Related plants will be populated here -->
                    </div>
                </div>
            </div>
        </div>
  </div>

    <script src="js/data.js"></script>
    <script src="js/header.js"></script>
<script>
        // Plant detail page functionality
        let currentPlant = null;

        document.addEventListener('DOMContentLoaded', () => {
            // Set active navigation
            if (window.Header) {
                window.Header.setActiveLink('plant');
            }

            // Get plant ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const plantId = urlParams.get('id');
            
            if (plantId) {
                loadPlantDetails(plantId);
            } else {
                showNotFound();
            }
        });

        function loadPlantDetails(plantId) {
            const plant = NM.getProduct(plantId);
            if (!plant) { showNotFound(); return; }
            currentPlant = plant;
            displayPlantDetails(plant);
            loadRelatedPlants(plant);
            loadReviews(plant);
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('plantDetails').classList.remove('hidden');
        }

        function displayPlantDetails(plant) {
            // Basic info
            document.getElementById('plantCategory').textContent = plant.category;
            document.getElementById('plantName').textContent = plant.name;
            document.getElementById('plantTitle').textContent = plant.name;
            document.getElementById('plantDescription').textContent = plant.description;
            document.getElementById('plantPrice').textContent = NM.formatCurrency(plant.price);
            document.getElementById('plantStock').textContent = plant.stock;
            
            // Category badge
            const categoryBadge = document.getElementById('categoryBadge');
            categoryBadge.textContent = plant.category;
            categoryBadge.className = `badge ${getCategoryBadgeClass(plant.category)}`;
            
            // Rating and reviews
            document.getElementById('plantRating').textContent = plant.rating;
            document.getElementById('plantReviews').textContent = `(${plant.reviews})`;
            
            // Plant details
            document.getElementById('careLevel').textContent = plant.careLevel;
            document.getElementById('waterNeeds').textContent = plant.waterNeeds;
            document.getElementById('lightNeeds').textContent = plant.lightNeeds;
            document.getElementById('plantHeight').textContent = plant.height;
            document.getElementById('potSize').textContent = plant.potSize;
            
            // Seller info
            const seller = getSellerInfo(plant.sellerId);
            document.getElementById('sellerName').textContent = seller ? seller.name : 'Unknown Seller';
            
            // Images
            if (plant.images && plant.images.length > 0) {
                document.getElementById('mainImage').src = plant.images[0];
                document.getElementById('mainImage').alt = plant.name;
                
                // Image gallery
                const imageGallery = document.getElementById('imageGallery');
                imageGallery.innerHTML = plant.images.map((img, index) => `
                    <div class="aspect-w-1 aspect-h-1 bg-gray-200 rounded-lg overflow-hidden cursor-pointer hover:opacity-75 transition-opacity">
                        <img src="${img}" alt="${plant.name}" class="w-full h-full object-cover" onclick="changeMainImage('${img}')">
                    </div>
                `).join('');
            }
            
            // Favorite button
            updateFavoriteButton(plant.id);
            
            // Bind event listeners
            bindPlantEvents(plant);
        }

        function getCategoryBadgeClass(category) {
            const categoryClasses = {
                'Indoor': 'primary',
                'Outdoor': 'secondary',
                'Succulent': 'success',
                'Flowering': 'warning',
                'Herbs': 'error'
            };
            return categoryClasses[category] || 'secondary';
        }

        function getSellerInfo(sellerId) {
            const users = JSON.parse(localStorage.getItem(NM.LS_KEYS.user));
            return users.find(u => u.id === sellerId);
        }

        function updateFavoriteButton(plantId) {
            const favoriteBtn = document.getElementById('favoriteBtn');
            const favoriteIcon = document.getElementById('favoriteIcon');
            
            if (NM.isFavorite(plantId)) {
                favoriteIcon.textContent = '★';
                favoriteBtn.classList.add('bg-yellow-500', 'text-white');
                favoriteBtn.classList.remove('secondary');
            } else {
                favoriteIcon.textContent = '☆';
                favoriteBtn.classList.remove('bg-yellow-500', 'text-white');
                favoriteBtn.classList.add('secondary');
            }
        }

        function bindPlantEvents(plant) {
            // Add to cart
            document.getElementById('addToCartBtn').addEventListener('click', () => {
                NM.addToCart(plant.id, 1);
                showMessage('Added to cart!', 'success');
                if (window.Header) { window.Header.updateCartCount(); }
            });
            
            // Favorite toggle
            document.getElementById('favoriteBtn').addEventListener('click', () => {
                if (NM.isFavorite(plant.id)) { NM.removeFromFavorites(plant.id); showMessage('Removed from favorites', 'info'); }
                else { NM.addToFavorites(plant.id); showMessage('Added to favorites!', 'success'); }
                updateFavoriteButton(plant.id);
            });
            
            // Message seller
            document.getElementById('messageSellerBtn').addEventListener('click', () => {
                const currentUser = NM.getCurrentUser();
                if (!currentUser) { window.location.href = 'login.html'; return; }
                window.location.href = `messages.html?start=${plant.sellerId}&product=${encodeURIComponent(plant.name)}`;
            });
            
            // Seller name click
            document.getElementById('sellerName').addEventListener('click', () => {
                // Could navigate to seller profile or show seller info
                showMessage(`Seller: ${getSellerInfo(plant.sellerId)?.name || 'Unknown'}`, 'info');
            });
        }

        function changeMainImage(imageSrc) {
            document.getElementById('mainImage').src = imageSrc;
        }

        function loadRelatedPlants(plant) {
            const all = NM.getAllProducts();
            const related = all.filter(p => p.id !== plant.id && p.category === plant.category).slice(0,4);
            
            const relatedContainer = document.getElementById('relatedPlants');
            
            if (related.length === 0) {
                relatedContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center">No related plants found.</p>';
                return;
            }
            
            relatedContainer.innerHTML = related.map(p => `
                <div class="product-card">
                    <img src="${p.images && p.images[0] ? p.images[0] : 'https://images.unsplash.com/photo-1593691509543-c55fb32e5cee?w=400&h=300&fit=crop'}" 
                         alt="${p.name}" class="product-image">
                    <div class="product-info">
                        <span class="badge ${getCategoryBadgeClass(p.category)}">${p.category}</span>
                        <h3 class="product-title">${p.name}</h3>
                        <p class="product-price">${NM.formatCurrency(p.price)}</p>
                        <div class="product-actions">
                            <a href="plant.html?id=${p.id}" class="btn primary flex-1">View Details</a>
                        </div>
        </div>
          </div>
            `).join('');
        }

        function loadReviews(plant) {
            const reviewsContainer = document.getElementById('reviewsSection');
            
            // Mock reviews for now
            const mockReviews = [
                {
                    user: 'Plant Lover',
                    rating: 5,
                    comment: 'Beautiful plant! Arrived in perfect condition.',
                    date: '2024-01-15'
                },
                {
                    user: 'Green Thumb',
                    rating: 4,
                    comment: 'Great quality, healthy plant. Highly recommend!',
                    date: '2024-01-10'
                }
            ];
            
            if (mockReviews.length === 0) {
                reviewsContainer.innerHTML = '<p class="text-gray-500 text-center">No reviews yet. Be the first to review!</p>';
                return;
            }
            
            reviewsContainer.innerHTML = mockReviews.map(review => `
                <div class="bg-white p-4 rounded-lg border">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <span class="font-medium">${review.user}</span>
                            <div class="flex text-yellow-400">
                                ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}
        </div>
      </div>
                        <span class="text-sm text-gray-500">${NM.formatDate(review.date)}</span>
                    </div>
                    <p class="text-gray-700">${review.comment}</p>
                </div>
            `).join('');
        }

        function showNotFound() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('notFoundState').classList.remove('hidden');
        }

        function showMessage(message, type = 'info') {
            // Remove existing messages
            const existingMessage = document.querySelector('.message-toast');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // Create message element
            const messageEl = document.createElement('div');
            messageEl.className = `message-toast fixed bottom-4 right-4 px-6 py-3 rounded-lg text-white z-50 transform translate-y-full transition-transform duration-300`;
            
            const typeClasses = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            };
            
            messageEl.className += ` ${typeClasses[type] || typeClasses.info}`;
            messageEl.textContent = message;
            
            document.body.appendChild(messageEl);
            
            // Animate in
            setTimeout(() => {
                messageEl.classList.remove('translate-y-full');
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                messageEl.classList.add('translate-y-full');
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.parentNode.removeChild(messageEl);
                    }
                }, 300);
            }, 3000);
  }
</script>
</body>
</html>
